(()=>{var e={743:e=>{e.exports={getNextSessionsHelper:e=>{const t={quiz:"",quizCount:0,quizFlag:!1,techSession:"",techSessionCount:0,techSessionFlag:!1,nonTechSession:"",nonTechSessionCount:0,nonTechSessionFlag:!1},n=["quiz","techSession","nonTechSession"];for(let s of n){let n=e.filter((e=>e.lastSession!==s&&!Object.values(t).includes(e.name)));for(let e=0;e<n.length;e++)t[`${s}Flag`]||(t[`${s}Count`]=n[e][s],t[`${s}Flag`]=!0,t[`${s}`]=n[e].name),console.log("bdsb",t),n[e][s]<t[`${s}Count`]&&(console.log("first"),t[`${s}Count`]=n[e][s],t[s]=n[e].name)}return t}}},49:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});const s=require("axios");var o=n.n(s),a=n(689),r=n.n(a);const i=function(e){const[t,n]=(0,a.useState)(!1),[s,i]=(0,a.useState)(""),[l,c]=(0,a.useState)(),[u,d]=(0,a.useState)(""),[m,p]=(0,a.useState)(""),[h,b]=(0,a.useState)("");return r().createElement("div",{className:"card"},r().createElement("div",{className:"our-card-top"},t&&r().createElement("div",{className:"our-custom-input"},r().createElement("div",{className:"our-custom-input-interior"},r().createElement("input",{onChange:e=>c(e.target.files[0]),className:"form-control form-control-sm",type:"file"}))),r().createElement("img",{src:e.photo?`/uploaded-photos/${e.photo}`:"/fallback.png",className:"card-img-top",alt:`The user is ${e.name}`})),r().createElement("div",{className:"card-body"},!t&&r().createElement(r().Fragment,null,r().createElement("h4",null,e.name),r().createElement("p",{className:"text-muted small"},"Quiz Count: ",e.quiz),r().createElement("p",{className:"text-muted small"},"Tech Sessions: ",e.techSession),r().createElement("p",{className:"text-muted small"},"Non Tech Sessions: ",e.nonTechSession),!e.readOnly&&r().createElement(r().Fragment,null,r().createElement("button",{onClick:()=>{n(!0),i(e.name),d(e.quiz),p(e.techSession),b(e.nonTechSession),c("")},className:"btn btn-sm btn-primary"},"Edit")," ",r().createElement("button",{onClick:async()=>{o().delete(`/user/${e.id}`),e.setUsers((t=>t.filter((t=>t._id!=e.id))))},className:"btn btn-sm btn-outline-danger"},"Delete"))),t&&r().createElement("form",{onSubmit:async function(t){t.preventDefault(),n(!1),e.setUsers((t=>t.map((function(t){return t._id==e.id?{...t,name:s,quiz:u,techSession:m,nonTechSession:h}:t}))));const a=new FormData;l&&a.append("photo",l),a.append("_id",e.id),a.append("name",s),a.append("quiz",u),a.append("techSession",m),a.append("nonTechSession",h);const r=await o().post("/update-user",a,{headers:{"Content-Type":"multipart/form-data"}});r.data&&e.setUsers((t=>t.map((function(t){return t._id==e.id?{...t,photo:r.data}:t}))))}},r().createElement("div",{className:"mb-1"},r().createElement("input",{autoFocus:!0,onChange:e=>i(e.target.value),type:"text",className:"form-control form-control-sm",value:s})),r().createElement("div",{className:"mb-2"},r().createElement("input",{onChange:e=>d(e.target.value),type:"text",className:"form-control form-control-sm",value:u})),r().createElement("div",{className:"mb-2"},r().createElement("input",{onChange:e=>p(e.target.value),type:"text",className:"form-control form-control-sm",value:m})),r().createElement("div",{className:"mb-2"},r().createElement("input",{onChange:e=>b(e.target.value),type:"text",className:"form-control form-control-sm",value:h})),r().createElement("button",{className:"btn btn-sm btn-success"},"Save")," ",r().createElement("button",{onClick:()=>n(!1),className:"btn btn-sm btn-outline-secondary"},"Cancel"))))}},860:e=>{"use strict";e.exports=require("express")},470:e=>{"use strict";e.exports=require("fs-extra")},13:e=>{"use strict";e.exports=require("mongodb")},738:e=>{"use strict";e.exports=require("multer")},423:e=>{"use strict";e.exports=require("path")},689:e=>{"use strict";e.exports=require("react")},684:e=>{"use strict";e.exports=require("react-dom/server")},109:e=>{"use strict";e.exports=require("sanitize-html")},441:e=>{"use strict";e.exports=require("sharp")}},t={};function n(s){var o=t[s];if(void 0!==o)return o.exports;var a=t[s]={exports:{}};return e[s](a,a.exports,n),a.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{const{MongoClient:e,ObjectId:t}=n(13),s=n(860),o=n(738)(),a=n(109),r=n(470),i=n(441);let l;const c=n(423),u=n(689),d=n(684),{getNextSessionsHelper:m}=n(743),p=n(49).Z;r.ensureDirSync(c.join("public","uploaded-photos"));const h=s();function b(e,t,n){"string"!=typeof e.body.name&&(e.body.name=""),"string"!=typeof e.body.quiz&&(e.body.quiz=""),"string"!=typeof e.body.techSession&&(e.body.techSession=""),"string"!=typeof e.body.nonTechSession&&(e.body.nonTechSession=""),"string"!=typeof e.body._id&&(e.body._id=""),e.cleanData={name:a(e.body.name.trim(),{allowedTags:[],allowedAttributes:{}}),quiz:a(e.body.quiz.trim(),{allowedTags:[],allowedAttributes:{}}),techSession:a(e.body.techSession.trim(),{allowedTags:[],allowedAttributes:{}}),nonTechSession:a(e.body.nonTechSession.trim(),{allowedTags:[],allowedAttributes:{}})},n()}h.set("view engine","ejs"),h.set("views","./views"),h.use(s.static("public")),h.use(s.json()),h.use(s.urlencoded({extended:!1})),h.get("/",(async(e,t)=>{const n=await l.collection("Users").find().sort({name:1}).toArray();console.log(n);const s=m(n),o=d.renderToString(u.createElement("div",{className:"container pt-3"},u.createElement("h1",{className:"mb-3"},"Dashboard"),u.createElement("h3",null,"Next week's sessions are taken by "),u.createElement("h6",null,"Quiz: ",s.quiz),u.createElement("h6",null,"Tech Session: ",s.techSession),u.createElement("h6",null,"Non Tech Session: ",s.nonTechSession),u.createElement("div",{className:"user-grid mb-3 mt-4"},n.map((e=>u.createElement(p,{key:e._id,name:e.name,quiz:e.quiz,techSession:e.techSession,nonTechSession:e.nonTechSession,photo:e.photo,id:e._id,readOnly:!0})))),u.createElement("p",null,u.createElement("a",{href:"/edit"},"Edit Users"))));t.render("home",{generatedHTML:o})})),h.get("/edit",((e,t)=>{t.render("edit")})),h.get("/api/users",(async(e,t)=>{const n=await l.collection("Users").find().sort({name:1}).toArray();t.json(n)})),h.post("/create-user",o.single("photo"),b,(async(e,n)=>{if(e.file){const t=`${Date.now()}.jpg`;await i(e.file.buffer).resize(844,456).jpeg({quality:60}).toFile(c.join("public","uploaded-photos",t)),e.cleanData.photo=t}console.log(e.body);const s=await l.collection("Users").insertOne(e.cleanData),o=await l.collection("Users").findOne({_id:new t(s.insertedId)});n.send(o)})),h.delete("/user/:id",(async(e,n)=>{"string"!=typeof e.params.id&&(e.params.id="");const s=await l.collection("Users").findOne({_id:new t(e.params.id)});s.photo&&r.remove(c.join("public","uploaded-photos",s.photo)),l.collection("Users").deleteOne({_id:new t(e.params.id)}),n.send("Deleted")})),h.post("/update-user",o.single("photo"),b,(async(e,n)=>{if(e.file){const s=`${Date.now()}.jpg`;await i(e.file.buffer).resize(844,456).jpeg({quality:60}).toFile(c.join("public","uploaded-photos",s)),e.cleanData.photo=s;const o=await l.collection("Users").findOneAndUpdate({_id:new t(e.body._id)},{$set:e.cleanData});o.value.photo&&r.remove(c.join("public","uploaded-photos",o.value.photo)),n.send(s)}else l.collection("Users").findOneAndUpdate({_id:new t(e.body._id)},{$set:e.cleanData}),n.send(!1)})),async function(){const t=new e("mongodb://root:root@localhost:27017/RoApp?&authSource=admin");await t.connect(),l=t.db(),h.listen(3e3)}()})()})();